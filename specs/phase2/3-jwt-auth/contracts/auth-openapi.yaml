openapi: 3.0.3
info:
  title: Todo API - Authentication
  description: JWT Authentication endpoints for the Todo API
  version: 1.0.0
  contact:
    name: Evolution of Todo Hackathon

servers:
  - url: http://localhost:8000
    description: Local development

tags:
  - name: Authentication
    description: User signup, login, and logout endpoints

paths:
  /api/auth/signup:
    post:
      tags:
        - Authentication
      summary: User Signup
      description: Register a new user account and receive a JWT token
      operationId: signup
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserCreate'
            examples:
              basic:
                summary: Basic signup
                value:
                  email: user@example.com
                  password: secretpassword123
              withName:
                summary: Signup with name
                value:
                  email: user@example.com
                  password: secretpassword123
                  name: John Doe
      responses:
        '201':
          description: User created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TokenResponse'
              example:
                access_token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                token_type: bearer
                user_id: 550e8400-e29b-41d4-a716-446655440000
                email: user@example.com
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                duplicateEmail:
                  summary: Email already registered
                  value:
                    detail: Email already registered
                weakPassword:
                  summary: Password too short
                  value:
                    detail: "Password must be at least 8 characters"
        '422':
          description: Validation error (Pydantic)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'

  /api/auth/login:
    post:
      tags:
        - Authentication
      summary: User Login
      description: Authenticate with email and password to receive a JWT token
      operationId: login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserLogin'
            example:
              email: user@example.com
              password: secretpassword123
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TokenResponse'
              example:
                access_token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                token_type: bearer
                user_id: 550e8400-e29b-41d4-a716-446655440000
                email: user@example.com
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                detail: Invalid credentials

  /api/auth/logout:
    post:
      tags:
        - Authentication
      summary: User Logout
      description: Log out the current user (client-side token discard)
      operationId: logout
      responses:
        '200':
          description: Logout successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
              example:
                message: Successfully logged out

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token from signup or login

  schemas:
    UserCreate:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          description: User's email address (must be unique)
          example: user@example.com
        password:
          type: string
          format: password
          minLength: 8
          description: Password (minimum 8 characters)
          example: secretpassword123
        name:
          type: string
          maxLength: 255
          nullable: true
          description: Optional display name
          example: John Doe

    UserLogin:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          description: Registered email address
          example: user@example.com
        password:
          type: string
          format: password
          description: Account password
          example: secretpassword123

    TokenResponse:
      type: object
      required:
        - access_token
        - token_type
        - user_id
        - email
      properties:
        access_token:
          type: string
          description: JWT access token
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        token_type:
          type: string
          enum: [bearer]
          description: Token type (always "bearer")
          example: bearer
        user_id:
          type: string
          format: uuid
          description: Authenticated user's ID
          example: 550e8400-e29b-41d4-a716-446655440000
        email:
          type: string
          format: email
          description: Authenticated user's email
          example: user@example.com

    MessageResponse:
      type: object
      required:
        - message
      properties:
        message:
          type: string
          description: Response message
          example: Successfully logged out

    ErrorResponse:
      type: object
      required:
        - detail
      properties:
        detail:
          type: string
          description: Error message
          example: Invalid credentials

    ValidationError:
      type: object
      required:
        - detail
      properties:
        detail:
          type: array
          items:
            type: object
            properties:
              loc:
                type: array
                items:
                  oneOf:
                    - type: string
                    - type: integer
              msg:
                type: string
              type:
                type: string

# Protected endpoints (reference only - defined in tasks-openapi.yaml)
# All /api/{user_id}/tasks/* endpoints require:
#   security:
#     - bearerAuth: []
# And middleware validates token.sub == user_id from URL
